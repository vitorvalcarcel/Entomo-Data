<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>An치lise de Importa칞칚o</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/estilo.css}">
    <style>
        .coluna-analise {
            background: #fff; border: 1px solid #ddd; border-radius: 6px; padding: 20px;
            height: 100%;
        }
        .titulo-coluna {
            font-size: 16px; font-weight: 700; margin-bottom: 5px; display: block; 
        }
        .controles-selecao {
            font-size: 12px; color: #999; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee;
        }
        .link-acao {
            color: #3498db; cursor: pointer; text-decoration: none; font-weight: 600;
        }
        .link-acao:hover { text-decoration: underline; }
        
        .lista-codigos {
            max-height: 400px; overflow-y: auto; border: 1px solid #f1f1f1; 
            border-radius: 4px; padding: 10px; background: #fbfbfb;
        }
        .item-codigo {
            display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #eee;
        }
        .tag-novo { background-color: #d4edda; color: #155724; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: auto; }
        .tag-existente { background-color: #fff3cd; color: #856404; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: auto; }
    </style>
    
    <script>
        function toggleAll(name, checked) {
            let checkboxes = document.getElementsByName(name);
            for(let i=0; i < checkboxes.length; i++) {
                checkboxes[i].checked = checked;
            }
        }
    </script>

    <script src="/js/heartbeat.js" defer></script>
    
</head>
<body>

    <div class="header-container">
        <h1>游늵 An치lise de Importa칞칚o <span style="font-weight: normal; font-size: 0.8em; color: #7f8c8d;">| Compara칞칚o com Banco</span></h1>
    </div>

    <form th:action="@{/importar/analise-banco}" method="post">
        <input type="hidden" name="nomeArquivo" th:value="${nomeArquivoSalvo}">
        <th:block th:each="entry : ${mapaAnterior}">
            <input type="hidden" th:name="${entry.key}" th:value="${entry.value}">
        </th:block>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            
            <div class="coluna-analise" style="border-top: 4px solid #27ae60;">
                <span class="titulo-coluna" style="color: #27ae60;">
                    游 Novos Registros (<span th:text="${analise.novos.size()}">0</span>)
                </span>
                
                <div class="controles-selecao">
                    Selecionar: 
                    <span class="link-acao" onclick="toggleAll('novosSelecionados', true)">Todos</span> | 
                    <span class="link-acao" onclick="toggleAll('novosSelecionados', false)">Nenhum</span>
                </div>
                
                <p style="font-size: 13px; color: #666;">Estes c칩digos n칚o existem no banco. Marque para <strong>ADICIONAR</strong>.</p>
                
                <div class="lista-codigos">
                    <div th:each="item : ${analise.novos}" class="item-codigo">
                        <label style="cursor: pointer; width: 100%; display: flex; align-items: center;">
                            <input type="checkbox" name="novosSelecionados" th:value="${item.cod}" checked style="margin-right: 10px;">
                            <strong th:text="${item.cod}">A001</strong>
                            <span class="tag-novo">Novo</span>
                        </label>
                    </div>
                    <div th:if="${analise.novos.empty}" style="padding: 20px; text-align: center; color: #999;">Nenhum registro novo encontrado.</div>
                </div>
            </div>

            <div class="coluna-analise" style="border-top: 4px solid #f39c12;">
                <span class="titulo-coluna" style="color: #e67e22;">
                    游댃 Registros Existentes (<span th:text="${analise.existentes.size()}">0</span>)
                </span>
                
                <div class="controles-selecao">
                    Selecionar: 
                    <span class="link-acao" onclick="toggleAll('existentesSelecionados', true)">Todos</span> | 
                    <span class="link-acao" onclick="toggleAll('existentesSelecionados', false)">Nenhum</span>
                </div>
                
                <p style="font-size: 13px; color: #666;">Estes c칩digos J츼 existem. Marque para <strong>EDITAR</strong> (Avan칞ado).</p>
                
                <div class="lista-codigos">
                    <div th:each="item : ${analise.existentes}" class="item-codigo">
                        <label style="cursor: pointer; width: 100%; display: flex; align-items: center;">
                            <input type="checkbox" name="existentesSelecionados" th:value="${item.cod}" style="margin-right: 10px;">
                            <strong th:text="${item.cod}">B002</strong>
                            <span class="tag-existente">Existe</span>
                        </label>
                    </div>
                    <div th:if="${analise.existentes.empty}" style="padding: 20px; text-align: center; color: #999;">Nenhum conflito encontrado.</div>
                </div>
            </div>

        </div>

        <div style="margin-top: 30px; text-align: right; border-top: 1px solid #eee; padding-top: 20px;">
            <a href="/" class="btn btn-cancelar" style="margin-right: 10px;">Cancelar Tudo</a>
            <button type="submit" class="btn btn-salvar">Avan칞ar e Processar >></button>
        </div>
    </form>

</body>
</html>